<!--
  Copyright (c) 2017 Bonnie Schulkin. All Rights Reserved.

  This file is part of BoxCharter.

  BoxCharter is free software: you can redistribute it and/or modify it under
  the terms of the GNU Affero General Public License as published by the Free
  Software Foundation, either version 3 of the License, or (at your option)
  any later version.

  BoxCharter is distributed in the hope that it will be useful, but WITHOUT
  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  for more details.

  You should have received a copy of the GNU Affero General Public License
  along with BoxCharter. If not, see <http://www.gnu.org/licenses/>.
-->

<div *ngIf="chart" (click)="statusService.clearSuccess()">
  <div class="save-btn">
    <span class="btn btn-primary" (click)="saveChart()">Save</span>
  </div>
  <input id="chart-title"
        class="title boxchart" 
        type="text" 
        size="64"
        placeholder="chart title"
        [(ngModel)]="chart.basicData.title">
  <clr-tree-node [clrTreeNodeExpanded]="true">
    Chart Authors
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="chart-composer">Music by</label>
      <input id="chart-composer"
          class="chart-md boxchart"
          type="text"
          size="48"
          placeholder="composer"
          [(ngModel)]="chart.basicData.composer">
    </clr-tree-node>
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="chart-lyricist">Lyrics by (</label>
      <input id="chart-lyricist-same" 
          type="checkbox" 
          [(ngModel)]="chart.basicData.lyricistSame">
        <label class="chart-md" for="chart-lyricist-same">Same as composer )</label>
      <span *ngIf="chart.basicData.lyricistSame == false">
        <input id="chart-lyricist"
            class="chart-md boxchart"
            type="text"
            size="48"
            placeholder="chart lyricist"
            [(ngModel)]="chart.basicData.lyricist">
      </span>
    </clr-tree-node>
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="chart-author">Chart by</label>
        <input id="chart-author"
          class="chart-md boxchart"
          type="text"
          size="48"
          placeholder="chart author"
          [(ngModel)]="chart.basicData.author">
    </clr-tree-node>
  </clr-tree-node>
  <clr-tree-node [clrTreeNodeExpanded]="true">
    Chart Keys
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="original-key">Original Key</label>
      <input id="original-key"
          class="chart-md boxchart"
          type="text"
          size="4"
          [(ngModel)]="chart.basicData.originalKey">
    </clr-tree-node>
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="transposed-key">Transposed Key</label>
      <input id="transposed-key"
          class="chart-md boxchart"
          type="text"
          size="4"
          [(ngModel)]="chart.basicData.printKey">
    </clr-tree-node>
  </clr-tree-node>
  <clr-tree-node [clrTreeNodeExpanded]="true">
    Chart Print Options
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="max-pages">Maximum chart pages</label>
      <input id="max-pages"
          class="chart-md boxchart"
          type="text"
          size="4"
          [(ngModel)]="chart.basicData.maxPages">
    </clr-tree-node>
    <clr-tree-node class="form-group chart-md">
      <label class="chart-md" for="min-fontsize">Minimum chart font size</label>
      <input id="min-fontsize"
          class="chart-md boxchart"
          type="text"
          size="4"
          [(ngModel)]="chart.basicData.minFontsize">
    </clr-tree-node>
  </clr-tree-node>
  <clr-tree-node [clrTreeNodeExpanded]="true">
    Chart Dates
    <clr-tree-node class="chart-md">
      Chart created: {{ chart.basicData.createdAt | date:'medium' }}
    </clr-tree-node>
    <clr-tree-node class="chart-md">
      Chart updated: {{ chart.basicData.modifiedAt | date:'medium' }}
    </clr-tree-node>
  </clr-tree-node>

  <!-- sections -->
  <div *ngFor="let section of chart.sections">
    <ng-container *ngIf="section.basicData as s">
      <h2>{{ s.sectionName }}</h2>
      <h5>{{ s.sectionDesc }}</h5>
      <table class="table table-compact">
      <!-- measures -->
      <ng-container *ngFor="let measure of section.measures; let i=index">
        <ng-container *ngIf="i % s.measuresPerRow == 0">
          <tr>
        </ng-container>
        <td>
          <!-- chords -->
          <table class="table table-compact">
            <tr>
              <!-- one chord box per beat -->
              <td class="chord" *ngFor="let j of s.beatsPerMeasure | fill">
                <input class="chord boxchart"
                       type="text" 
                       id="chord-{{j}}" 
                       value="{{ measure.chords.hasOwnProperty(j) ? 
                                 measure.chords[j] : null }}" 
                       size="4" 
                       placeholder="/">
                </td>
              </tr>
            <!-- lyrics -->
              <tr *ngFor="let k of s.verseCount | fill">
                <td [attr.colspan]="s.beatsPerMeasure">
                  <input type="text" 
                        id="lyric-{{k}}" 
                        value="{{ measure.lyrics.hasOwnProperty(k) ? 
                                  measure.lyrics[k] : null }}" 
                        size="30">
                </td>
              </tr>
            </table>
          </td>
        <ng-container *ngIf="i % s.measuresPerRow == s.measuresPerRow">
          <tr>
        </ng-container>
      </ng-container>
    </table>
    </ng-container>
  </div>
</div>
